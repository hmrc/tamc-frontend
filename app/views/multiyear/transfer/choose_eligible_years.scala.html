@*
 * Copyright 2025 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.twirl.api.Html
@import views.helpers.LanguageUtilsImpl
@import config.ApplicationConfig
@import java.text.NumberFormat
@import models.auth.AuthenticatedUserRequest
@import models.ApplyForEligibleYears
@import includes.{H1, H2, P, Button, InputRadios, ErrorSummary}
@import uk.gov.hmrc.govukfrontend.views.viewmodels.checkboxes.CheckboxItem
@import uk.gov.hmrc.govukfrontend.views.html.components.GovukCheckboxes

@import views.Main

@this(
    main: Main,
    errorSummary: ErrorSummary,
    applicationConfig: ApplicationConfig,
    formCSRF: FormWithCSRF,
    languageUtilsImpl: LanguageUtilsImpl,
    h1: H1,
    h2: H2,
    p: P,
    viewHelpers: utils.ViewHelpers,
    inputRadios: InputRadios,
    govukCheckboxes: GovukCheckboxes,
    button: Button
)

@(
    form: Form[?],
    currentTaxYear: java.time.LocalDate
)(
    implicit messages: Messages,
    request: AuthenticatedUserRequest[?]
)

@main(
    pageTitle = messages("title.choose-years"),
    serviceTitle = "title.application.pattern",
    backLinkHref = Some(controllers.transfer.routes.DateOfMarriageController.dateOfMarriage().url)
) {

    @errorSummary(form)

    @h1("title.choose-years")

    @formCSRF(action = transfer.routes.ChooseYearsController.chooseYearsAction(), args = (Symbol("id") -> "choose-year-form")) {

    @{
      val checkboxItems: Seq[CheckboxItem] = ApplyForEligibleYears
        .options(languageUtilsImpl().ukDateTransformer(currentTaxYear))
        .map { item =>
          CheckboxItem(
            content = item.content,
            value   = item.value,
            checked = form.data.getOrElse("value[]", "").contains(item.value),
            id = item.id
          )
        }

      val checkboxesArgs = Checkboxes(
        name = "value[]",
        fieldset = Some(Fieldset(
        legend = Some(Legend(
          content = Text(messages("title.choose-years")),
          classes = "govuk-visually-hidden",
          isPageHeading = false
        ))
      )),
      hint = Some(Hint(content = Text(messages("pages.form.field-helper.chooseYears")))),
      items = checkboxItems,
      attributes = Map("data-inline-error" -> "current-year-error"),
      errorMessage = form.error("value").map(e => ErrorMessage(content = Text(messages("pages.chooseYears.error.required"))))
      )

      govukCheckboxes(checkboxesArgs)
    }

    @button(
        msg = "generic.continue",
        attrs = Map(
            "data-journey-click" ->
            "marriage-allowance:button:chooseyear_continue"
            )
        )
    }
}