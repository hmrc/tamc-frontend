@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import java.text.NumberFormat
@import config.ApplicationConfig
@import views.html.templates._
@import models.auth.UserRequest
@import includes.{ErrorSummary, InputRadios, PageHeading, Button, P}

@this(
main: main,
errorSummary: ErrorSummary,
inputRadios: InputRadios,
pageHeading: PageHeading,
button: Button,
form: FormWithCSRF,
applicationConfig: ApplicationConfig,
p: P)

@(
    partnersIncomeFormInput: Form[MultiYearPartnersIncomeQuestionInput],
    scottishResident: Boolean
)(
    implicit messages: Messages, request: UserRequest[_]
)

@maxLimit = @{
    if (scottishResident) applicationConfig.MAX_LIMIT_SCOT()
    else applicationConfig.MAX_LIMIT()
}

@main(pageTitle = Some(Messages("title.eligibility.pattern",
    Messages("eligibility.check.partners.income.h1",
        NumberFormat.getIntegerInstance().format(applicationConfig.PERSONAL_ALLOWANCE() + 1),
        NumberFormat.getIntegerInstance().format(maxLimit)
    ))),
    backLinkHref = Some(controllers.routes.EligibilityController.lowerEarnerCheck.url)
) {

    @errorSummary(partnersIncomeFormInput, Some("partners-income-true"))

    @pageHeading(classes=Some("govuk-!-margin-bottom-3 govuk-heading-xl"),
                context = "This section is ",
                section = "eligibility.check.span.h1",
                text = Messages("eligibility.check.partners.income.h1", NumberFormat.getIntegerInstance().format(applicationConfig.PERSONAL_ALLOWANCE() +
                                1), NumberFormat.getIntegerInstance().format(maxLimit))
    )

    @p(Text(Messages("eligibility.check.partners.income.information1")), elmId = Some("partner-income-text"))

    @form(action = routes.EligibilityController.partnersIncomeCheckAction, args = 'id -> "income-form") {

        <input type="hidden" id="is-scottish" name="is-scottish" value=@scottishResident />
        <div class="form-group inline">
            @inputRadios(
                form = partnersIncomeFormInput,
                legend = "eligibility.check.partners.income.h1",
                id = Some("partners-income"),
                name = "partners-income",
                items = Seq(RadioItem(
                                content = Text(messages("radio.yes")),
                                value = Some("true"),
                                id = Some("partners-income-true")
                            ), RadioItem(
                                content = Text(messages("radio.no")),
                                value = Some("false"),
                                id = Some("partners-income-false")
                            )),
                legendAsHeading = false,
                fieldSetAttrs = Map("data-inline-error" -> "inline-partners-income-error", "id" -> "marriage-criteria"),
                legendClasses = "govuk-visually-hidden"
            )
        </div>

        <div class="tamc-js-hidden error-inline validation-summary partners-inc-error" id="inline-partners-income-error">
            @p(Text(Messages("eligibility.check.partners.income.error")))
        </div>

        <div class="form-group">
            @button(msg = "generic.continue", id = "continue", attrs = Map("data-journey-click" -> "marriage-allowance:click:advance-from-eligibility-questions"))
        </div>
    }

}
